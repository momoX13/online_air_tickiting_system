<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Online Air Ticketing System - Single File</title>
  <style>
    :root{ --accent:#0b72ff; --muted:#6b7280; --card:#ffffff; --bg:#f3f4f6; --danger:#ef4444 }
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial; margin:0; background:linear-gradient(180deg, #f8fafc, var(--bg)); color:#0f172a}
    header{background:linear-gradient(90deg,#0b72ff 0%, #06b6d4 100%); color:white; padding:28px 20px}
    .wrap{max-width:1100px;margin:18px auto;padding:0 16px}
    h1{margin:0;font-size:1.25rem}
    p.lead{margin:6px 0 0; color:rgba(255,255,255,0.95); font-size:0.95rem}

    .card{background:var(--card); border-radius:12px; box-shadow:0 6px 20px rgba(2,6,23,0.06); padding:18px}
    .search{display:grid; grid-template-columns: repeat(12,1fr); gap:12px; align-items:end}
    label{display:block;font-size:0.8rem;color:var(--muted); margin-bottom:6px}
    input[type=text], input[type=date], select, input[type=number]{width:100%; padding:10px 12px;border-radius:8px;border:1px solid #e6e9ee}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid #e6e9ee;color:var(--muted)}

    .col-6{grid-column:span 6}
    .col-4{grid-column:span 4}
    .col-3{grid-column:span 3}
    .col-2{grid-column:span 2}
    .col-12{grid-column:span 12}

    main{margin-top:18px}
    .results{display:grid; grid-template-columns:1fr 380px; gap:18px}
    .flight{display:flex; gap:12px; align-items:center; padding:12px; border-radius:10px; border:1px solid #eef2ff}
    .flight .meta{flex:1}
    .price{font-weight:800; font-size:1.1rem; color:#05204a}
    .tiny{font-size:0.82rem; color:var(--muted)}

    /* right summary */
    .summary{position:sticky; top:18px}
    .summary .row{display:flex; justify-content:space-between; margin:8px 0}

    /* modal */
    .modal-backdrop{position:fixed; inset:0; background:rgba(2,6,23,0.5); display:none; align-items:center; justify-content:center}
    .modal{max-width:760px; width:95%; background:white; border-radius:12px; padding:18px}

    .flex{display:flex; gap:12px; align-items:center}
    .seats{display:flex; gap:8px; flex-wrap:wrap}
    .seat{padding:8px 10px;border-radius:6px;border:1px solid #e6e9ee; cursor:pointer}
    .seat.selected{background:#eef2ff; border-color:var(--accent)}

    footer{text-align:center; margin:36px 0 80px; color:var(--muted); font-size:0.9rem}

    /* responsiveness */
    @media (max-width:980px){
      .results{grid-template-columns:1fr}
      .search{grid-template-columns: repeat(6,1fr)}
      .col-6{grid-column:span 6}
      .col-4{grid-column:span 3}
      .col-3{grid-column:span 2}
    }

    @media (max-width:640px){
      header{padding:18px 12px}
      .search{grid-template-columns: repeat(2,1fr)}
      .col-6{grid-column:span 2}
      .col-12{grid-column:span 2}
      .col-3{grid-column:span 1}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>SkyBook — Online Air Ticketing System</h1>
      <p class="lead">Search flights, choose seats, enter passenger details and get an e-ticket — all in one file.</p>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <form id="searchForm" class="search" onsubmit="return false">
        <div class="col-3">
          <label for="from">From</label>
          <input id="from" type="text" placeholder="City or Airport (e.g. Mumbai - BOM)" value="Mumbai" required />
        </div>
        <div class="col-3">
          <label for="to">To</label>
          <input id="to" type="text" placeholder="City or Airport (e.g. Delhi - DEL)" value="Delhi" required />
        </div>
        <div class="col-2">
          <label for="depart">Depart</label>
          <input id="depart" type="date" required />
        </div>
        <div class="col-2">
          <label for="return">Return (optional)</label>
          <input id="ret" type="date" />
        </div>
        <div class="col-2">
          <label for="pax">Passengers</label>
          <input id="pax" type="number" min="1" max="9" value="1" />
        </div>

        <div class="col-2" style="grid-column-end:span 2">
          <label for="cl">Class</label>
          <select id="cl">
            <option>Economy</option>
            <option>Premium Economy</option>
            <option>Business</option>
            <option>First Class</option>
          </select>
        </div>

        <div class="col-12" style="display:flex; gap:10px; justify-content:flex-end;" >
          <button class="btn ghost" id="swapBtn" title="Swap From/To">Swap</button>
          <button class="btn" id="searchBtn">Search Flights</button>
        </div>
      </form>
    </div>

    <main>
      <div class="results" style="margin-top:16px">
        <div>
          <div id="resultsList" class="card">
            <p class="tiny">No results yet — enter search criteria and click <strong>Search Flights</strong>.</p>
          </div>
        </div>

        <aside class="summary card summary" id="tripSummary">
          <h3 style="margin:0 0 6px 0">Trip Summary</h3>
          <div class="row"><div class="tiny">Route</div><div id="sumRoute">—</div></div>
          <div class="row"><div class="tiny">Dates</div><div id="sumDates">—</div></div>
          <div class="row"><div class="tiny">Passengers</div><div id="sumPax">1</div></div>
          <hr />
          <div class="row"><div class="tiny">Selected Flight</div><div id="sumFlight">—</div></div>
          <div class="row" style="font-weight:700"><div>Total</div><div id="sumPrice">₹0</div></div>
          <div style="margin-top:12px">
            <button class="btn" id="proceedBtn" disabled>Proceed to Book</button>
          </div>
        </aside>
      </div>

      <div style="height:12px"></div>

      <div id="ticketArea"></div>

    </main>

    <div class="modal-backdrop" id="modal">
      <div class="modal" role="dialog" aria-modal="true">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3 id="modalTitle">Book Flight</h3>
          <button class="btn ghost" id="closeModal">Close</button>
        </div>
        <hr />
        <div id="modalBody">
          <!-- filled by JS -->
        </div>
      </div>
    </div>

    <footer>
      <small>Demo only — no real payments. Built as a single-file example.</small>
    </footer>
  </div>

  <script>
    // basic utility
    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));

    // init default depart date to tomorrow
    const departEl = qs('#depart');
    const tomorrow = new Date(Date.now() + 24*60*60*1000);
    departEl.value = tomorrow.toISOString().slice(0,10);

    // elements
    const swapBtn = qs('#swapBtn');
    const searchBtn = qs('#searchBtn');
    const resultsList = qs('#resultsList');
    const sumRoute = qs('#sumRoute');
    const sumDates = qs('#sumDates');
    const sumPax = qs('#sumPax');
    const sumFlight = qs('#sumFlight');
    const sumPrice = qs('#sumPrice');
    const proceedBtn = qs('#proceedBtn');
    const modal = qs('#modal');
    const modalBody = qs('#modalBody');
    const modalTitle = qs('#modalTitle');
    const closeModal = qs('#closeModal');
    const ticketArea = qs('#ticketArea');

    // swap from/to
    swapBtn.addEventListener('click', e => {
      e.preventDefault();
      const f = qs('#from'); const t = qs('#to'); [f.value, t.value] = [t.value, f.value];
    });

    // mock flight generator
    function generateFlights(from,to, date, pax, cls){
      const base = ['SG-','AI-','6E-','IX-','UK-'];
      const times = ['05:00','07:30','09:45','12:00','15:20','18:15','21:00'];
      const flights = [];
      for(let i=0;i<6;i++){
        const carrier = base[i%base.length];
        const dep = times[i%times.length];
        const durH = 1 + Math.floor(Math.random()*6);
        const arr = addHours(dep, durH);
        const price = Math.round((2500 + Math.random()*8500) * priceMultiplier(cls) * pax);
        flights.push({id: carrier + (100+i), carrier:carrier.replace('-',''), flightNo: carrier + (100+i), dep, arr, dur: durH + 'h', price});
      }
      return flights;
    }

    function priceMultiplier(cls){
      switch(cls){ case 'Economy': return 1; case 'Premium Economy': return 1.5; case 'Business': return 2.8; case 'First Class': return 4; default: return 1 }
    }

    function addHours(hhmm, hours){
      const [h,m] = hhmm.split(':').map(Number);
      const dt = new Date(); dt.setHours(h+hours); dt.setMinutes(m);
      const ph = String(dt.getHours()).padStart(2,'0');
      const pm = String(dt.getMinutes()).padStart(2,'0');
      return ph + ':' + pm;
    }

    // render results
    searchBtn.addEventListener('click', e => {
      e.preventDefault();
      const from = qs('#from').value.trim();
      const to = qs('#to').value.trim();
      const date = qs('#depart').value;
      const ret = qs('#ret').value;
      const pax = Number(qs('#pax').value);
      const cls = qs('#cl').value;
      if(!from||!to||!date){ alert('Please fill From, To and Depart date'); return }
      const flights = generateFlights(from,to,date,pax,cls);
      renderSearchResults(flights, {from,to,date,ret,pax,cls});
      // update summary
      sumRoute.textContent = from + ' → ' + to;
      sumDates.textContent = date + (ret?(' — ' + ret):'');
      sumPax.textContent = pax + ' ('+cls+')';
    });

    function renderSearchResults(flights, meta){
      resultsList.innerHTML = '';
      flights.forEach(f => {
        const el = document.createElement('div'); el.className = 'flight';
        el.innerHTML = `
          <div style="width:78px;text-align:center">
            <div style="font-weight:800">${f.carrier}</div>
            <div class="tiny">${f.flightNo}</div>
          </div>
          <div class="meta">
            <div style="display:flex; gap:12px; align-items:center">
              <div style="min-width:96px">
                <div style="font-weight:700">${f.dep}</div>
                <div class="tiny">Departure</div>
              </div>
              <div style="min-width:96px">
                <div style="font-weight:700">${f.arr}</div>
                <div class="tiny">Arrival</div>
              </div>
              <div style="min-width:80px">
                <div class="tiny">Duration</div>
                <div class="tiny">${f.dur}</div>
              </div>
            </div>
            <div style="margin-top:8px" class="tiny">Non-stop • Refundable rules vary</div>
          </div>
          <div style="text-align:right; min-width:120px">
            <div class="price">₹${f.price.toLocaleString()}</div>
            <div style="margin-top:8px"><button class="btn" data-book='${JSON.stringify({f,meta})}'>Book</button></div>
          </div>
        `;
        resultsList.appendChild(el);
      });

      // attach book handlers
      qsa('[data-book]').forEach(btn => btn.addEventListener('click', e => {
        const payload = JSON.parse(btn.getAttribute('data-book'));
        openBookingModal(payload.f, payload.meta);
      }));
    }

    function openBookingModal(flight, meta){
      modalTitle.textContent = `Book ${flight.flightNo} — ${meta.from} → ${meta.to}`;
      modalBody.innerHTML = `
        <h4 style="margin-top:0">Flight & Fare</h4>
        <div style="display:flex; justify-content:space-between;">
          <div><strong>${flight.carrier} ${flight.flightNo}</strong><div class="tiny">${meta.date} • ${flight.dep} → ${flight.arr}</div></div>
          <div style="text-align:right"><div style="font-weight:800">₹${flight.price.toLocaleString()}</div><div class="tiny">for ${meta.pax} pax</div></div>
        </div>
        <hr />
        <form id="bookForm">
          <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:10px">
            <div>
              <label>Passenger Name</label>
              <input id="pname" required placeholder="Full name as on ID" />
            </div>
            <div>
              <label>Passenger Age</label>
              <input id="page" type="number" min="0" max="120" value="30" />
            </div>
            <div>
              <label>Gender</label>
              <select id="pgender"><option>Male</option><option>Female</option><option>Other</option></select>
            </div>
            <div>
              <label>Seat Preference</label>
              <select id="pseat"><option>Aisle</option><option>Window</option><option>Any</option></select>
            </div>
          </div>

          <div style="margin-top:12px">
            <label>Select Seat (choose one)</label>
            <div class="seats" id="seatMap"></div>
          </div>

          <hr />
          <h4>Mock Payment</h4>
          <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:8px">
            <div>
              <label>Card Number</label>
              <input id="card" placeholder="1234 5678 9012 3456" />
            </div>
            <div>
              <label>Name on Card</label>
              <input id="cardname" placeholder="Full name" />
            </div>
            <div>
              <label>Expiry</label>
              <input id="exp" placeholder="MM/YY" />
            </div>
            <div>
              <label>CVC</label>
              <input id="cvc" placeholder="123" />
            </div>
          </div>

          <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end">
            <button class="btn ghost" id="cancelBook">Cancel</button>
            <button class="btn" id="confirmBook">Confirm & Pay</button>
          </div>
        </form>
      `;

      // populate seat map
      const seatMap = modalBody.querySelector('#seatMap');
      seatMap.innerHTML = '';
      const seats = generateSeatNumbers(30);
      seats.forEach(s => {
        const d = document.createElement('div'); d.className='seat'; d.textContent = s; d.dataset.seat=s;
        d.addEventListener('click', ()=>{
          qsa('.seat').forEach(x=>x.classList.remove('selected'));
          d.classList.add('selected');
        });
        seatMap.appendChild(d);
      });

      // handlers
      modal.style.display='flex';

      modalBody.querySelector('#cancelBook').addEventListener('click', ev=>{ ev.preventDefault(); modal.style.display='none'; });
      modalBody.querySelector('#closeModal')?.addEventListener('click', ev=>{ ev.preventDefault(); modal.style.display='none'; });
      modalBody.querySelector('#confirmBook').addEventListener('click', ev=>{
        ev.preventDefault();
        const name = modalBody.querySelector('#pname').value.trim();
        if(!name){ alert('Enter passenger name'); return }
        const seat = modalBody.querySelector('.seat.selected');
        if(!seat){ alert('Please select a seat'); return }
        // create ticket
        const ticket = {
          bookingRef: 'SB' + Math.random().toString(36).slice(2,9).toUpperCase(),
          passenger: {name, age: modalBody.querySelector('#page').value, gender: modalBody.querySelector('#pgender').value, seat: seat.dataset.seat},
          flight: flight, meta: meta,
          price: flight.price
        };
        renderTicket(ticket);
        // update summary
        sumFlight.textContent = flight.flightNo + ' • ' + ticket.passenger.name + ' • ' + ticket.passenger.seat;
        sumPrice.textContent = '₹' + ticket.price.toLocaleString();
        proceedBtn.disabled = false;
        modal.style.display='none';
      });

      // clicking outside closes
      modal.addEventListener('click', e=>{ if(e.target===modal) modal.style.display='none'; });
    }

    closeModal.addEventListener('click', ()=> modal.style.display='none');

    function generateSeatNumbers(n){
      const arr=[]; const rows = Math.ceil(n/6);
      const cols = ['A','B','C','D','E','F'];
      for(let r=1;r<=rows;r++) for(let c=0;c<6;c++) if(arr.length<n) arr.push(r+cols[c]);
      return arr;
    }

    function renderTicket(ticket){
      ticketArea.innerHTML = `
        <div class="card" style="margin-top:12px">
          <h3 style="margin:0 0 8px 0">E-Ticket — ${ticket.bookingRef}</h3>
          <div style="display:flex; gap:16px; align-items:center">
            <div style="flex:1">
              <div style="font-weight:800">${ticket.flight.carrier} ${ticket.flight.flightNo}</div>
              <div class="tiny">${ticket.meta.from} → ${ticket.meta.to} • ${ticket.meta.date}</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:800; font-size:1.2rem">₹${ticket.price.toLocaleString()}</div>
              <div class="tiny">Paid (mock)</div>
            </div>
          </div>
          <hr />
          <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px">
            <div><div class="tiny">Passenger</div><div>${ticket.passenger.name}</div></div>
            <div><div class="tiny">Seat</div><div>${ticket.passenger.seat}</div></div>
            <div><div class="tiny">Age</div><div>${ticket.passenger.age}</div></div>
          </div>
          <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end">
            <button class="btn" id="downloadTicket">Download Ticket</button>
            <button class="btn ghost" id="printTicket">Print</button>
          </div>
        </div>
      `;

      qs('#downloadTicket').addEventListener('click', ()=>downloadTicketAsFile(ticket));
      qs('#printTicket').addEventListener('click', ()=>{ window.print(); });
    }

    function downloadTicketAsFile(ticket){
      const content = `E-TICKET\nBooking Ref: ${ticket.bookingRef}\nPassenger: ${ticket.passenger.name}\nFlight: ${ticket.flight.flightNo}\nRoute: ${ticket.meta.from} -> ${ticket.meta.to}\nDate: ${ticket.meta.date}\nSeat: ${ticket.passenger.seat}\nPrice: ₹${ticket.price}\n\n(This is a demo e-ticket — not valid for travel)`;
      const blob = new Blob([content], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `${ticket.bookingRef}_eticket.txt`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    // Proceed button — just scrolls to ticket area
    proceedBtn.addEventListener('click', ()=>{ ticketArea.scrollIntoView({behavior:'smooth'}); });

    // little helper: format price when number
    Number.prototype.toCurrencyString = function(){ return '₹'+this.toLocaleString(); };

    // small demo: initialize with example search results
    document.addEventListener('DOMContentLoaded', ()=>{
      // set a sample search on load
      // leave commented out to avoid auto-search
      // qs('#searchBtn').click();
    });
  </script>
</body>
</html>
